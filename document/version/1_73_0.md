# Boost 1.73.0リリースノート

本家リリースノート：

- <https://github.com/boostorg/website/blob/master/feed/history/boost_1_73_0.qbk>
- <http://www.boost.org/users/history/version_1_73_0.html>


リポジトリは以下：

- <https://github.com/boostorg/>


リポジトリからのビルド方法は、egtraさんのブログを参照：

- 「[Modularized Boost（GitHubへ移行したリポジトリ）を使用する](http://dev.activebasic.com/egtra/2013/12/03/620/)」


## 新ライブラリ

- [Nowide](https://www.boost.org/libs/nowide/)
    - Windowsで標準ライブラリと組み合わせて使用するUTF-8 API (作者Artyom Beilis)


## 更新ライブラリ

- [Any](#any)
- [Assert](#assert)
- [Atomic](#atomic)
- [Beast](#beast)
- [Context](#context)
- [Conversion](#conversion)
- [DLL](#dll)
- [Flyweight](#flyweight)
- [GIL](#gil)
- [LexicalCast](#lexical-cast)
- [Log](#log)
- [Mp11](#mp11)
- [Multi-index](#multi-index)
- [Outcome](#outcome)
- [PolyCollection](#poly-collection)
- [Stacktrace](#stacktrace)
- [ThrowException](#throw-exception)
- [TypeIndex](#type-index)
- [Variant](#variant)
- [Variant2](#variant2)


## 更新ツール

- [B2](#b2)


## <a id="any" href="#any">Any</a>

- `<algorithm>`をインクルードしないことでコンパイル速度を向上
- CI強化を含むメンテナンス作業


## <a id="assert" href="#assert">Assert</a>

- `source_location`クラスを追加


## <a id="atomic" href="#atomic">Atomic</a>

- C++20の`atomic_ref`を実装。[ドキュメント](https://www.boost.org/doc/html/atomic/interface.html#atomic.interface.interface_atomic_ref)と[注意書き](https://www.boost.org/doc/html/atomic/interface.html#atomic.interface.interface_atomic_ref.caveats)を参照
- C++20で導入された`atomic_flag::test`操作を実装
- `atomic<T>`は`T`のアライメント要件を考慮するべきであり、それらが`atomic`の内部ストレージより高い要件の場合に違いが生じる
- <span style="color:red;">**破壊的変更**</span> `atomic`と`atomic_ref`で使用される値型`T`の要件を表明する静的アサートを追加。これにより、不正な型をアトミックに使用することを禁止する
- 内部のロックプールの実装を改善。プールをより大きくし、ロックの選択にはアトミックオブジェクトのアライメントを考慮するようにした。これにより、スレッド競合 (thread contention) の可能性が減る
- 8ビットと16ビットの引数に対する`bit_test_and_*`操作で生成される不正なx86コードを修正。他のアーキテクチャには影響しない
- `value_type`のアライメント要件が`atomic`の内部ストレージより小さい場合に、`compare_exchange_*`操作がアライメントされていないメモリアクセスをしてしまう可能性があったのを修正
- <span style="color:red;">**破壊的変更**</span> `boost/atomic/atomic.hpp`が`boost/atomic/atomic_flag.hpp`と`boost/atomic/fences.hpp`をインクルードせず、`boost::atomic`クラステンプレートと関連する型の別名のみを定義するようにした。必要な場合はそれぞれのヘッダを明示的にインクルードするか、Boost.Atomicの全てをインクルードする`boost/atomic.hpp`を使用すること
- `atomic<T>::storage()`アクセッサと関連する`atomic<T>::storage_type`型を非推奨化。代わりに`atomic<T>::value()`と`atomic<T>::value_type`を使用することを推奨する。ユーザーは`BOOST_ATOMIC_SILENCE_STORAGE_DEPRECATION`を定義することで非推奨の警告を無効にできる。非推奨となった機能は将来のリリースで削除される
- `BOOST_ATOMIC_DETAIL_HIGHLIGHT_OP_AND_TEST`のサポートを削除。このマクロは1.73.0の2年前にリリースされたBoost.Atomicの1.67.0において`*_and_test`操作の変更された戻り値への移行を助けるためにあった


## <a id="beast" href="#beast">Beast</a>

- 今回はメンテナンスアップデートとなる
- Beast dynamic buffers内の入れ小型`mutable_data_type`を非推奨化した。代わりに`mutable_buffers_type`を使用するか`BOOST_BEAST_ALLOW_DEPRECATED`をdefineすること。影響を受ける型は以下：
    - `buffers_adaptor`
    - `flat_buffer`
    - `flat_static_buffer`
    - `multi_buffer`
    - `static_buffer`
- このライブラリを使用しているユーザーもしくはユーザー企業がどのようにこのライブラリを使用しているか教えてほしい。以下にリストがある：
    - [Companies and Individuals Using Beast](https://github.com/boostorg/beast/wiki/Companies-and-Individuals-Using-Beast)
- 雑多な修正
    - ルート証明の例を更新
- 修正
    - Content-Lengthの解析を修正
    - `buffer_bytes`のドキュメントを正した
    - strandにディスパッチする例を修正
    - `basic_stream::close`が例外を投げないことを保証
    - sha1.hpp内のインクルード漏れを修正
    - `ostream`の警告を修正
    - field digestはエンディアン非依存
    - README内のリンク切れを修正
    - `ostream`のフラッシュを修正
    - いくつかのWin32エラーをネットワークエラーコードに修正
    - `flat_buffer::shrink_to_fit`を`noexcept`にした
    - eraseフィールドを修正
    - コンパイル設定のドキュメントを修正
    - strandを使用する例を正した
    - `File:read`でのend-of-fileの動作をドキュメントで明確にした
    - `file_body`がeofの読み込み時に`short_read`を返すようにした
    - Win32での`file_body`のバグを修正
    - `ostream_buffer`が`DynamicBuffer_v1::commit`の事前条件を満たすようにした
    - `basic_file_body`のFileメンバにアクセッサ関数を追加
    - リリースビルドのドキュメントを修正
    - `file_win32`がUTF-8パスをサポート
    - `file_stdio`がUnicodeパスをサポート
    - `echo-op`のテストを修正
    - `file_win32`のボディが`http::serializer::split`を尊重するようにした
    - 非MSVCのcmakeを修正


## <a id="context" href="#context">Context</a>

- [GitHub #133](https://github.com/boostorg/context/pull/133) IBM Zのfcontextルーチンを修正
- [GitHub #132](https://github.com/boostorg/context/pull/132) mips64/n64のalignを2から3に修正
- [GitHub #131](https://github.com/boostorg/context/pull/131) OSプラットフォームとしてMIPS32とMIPS64で異なるABIを使用するようにした
- [GitHub #129](https://github.com/boostorg/context/pull/129) RISC-Vアセンブリのnon-PICを修正


## <a id="conversion" href="#conversion">Conversion</a>

- 参照用の`boost::polymorphic_downcast`を追加 (Julien Delacroix氏のパッチに感謝)
- 重大なドキュメント更新


## <a id="dll" href="#dll">DLL</a>

- [GitHub #35](https://github.com/boostorg/dll/pull/35) `boost::dll::smart_library`内のデマングリングを修正してテスト (Ramil Gauss氏に感謝)
- [GitHub #30](https://github.com/boostorg/dll/issues/30) `boost::dll::load_mode::type`に対するUBSanを通るようにした
- [GitHub #34](https://github.com/boostorg/dll/pull/34) MPLへの依存をやめてコンパイル速度を改善 (Nikita Kniazev氏に感謝)
- [GitHub #33](https://github.com/boostorg/dll/pull/33) WindowsのClangとICC対応を修正し、これらのプラットフォームをCIでサポート (Nikita Kniazev氏に感謝)
- CI強化とテスト改善を含むメンテナンス作業


## <a id="flyweight" href="#flyweight">Flyweight</a>

- メンテナンス上の修正


## <a id="gil" href="#gil">GIL</a>

- 追加
    - [GitHub #457](https://github.com/boostorg/gil/pull/457) `image`クラスにムーブコンストラクタとムーブ代入演算子を追加
    - [GitHub #456](https://github.com/boostorg/gil/pull/456) `any_image_view`クラスに`size()`メンバ関数を追加
- 変更
    - [GitHub #459](https://github.com/boostorg/gil/pull/459), [GitHub #464](https://github.com/boostorg/gil/pull/464) GIL内で使用するテストフレームワークをBoost.TestからBoost.LightweightTestに置き換えた。それにともない、`test/extension/io/`サブツリーと`Jamfile`関連のターゲットを再構築
    - [GitHub #459](https://github.com/boostorg/gil/pull/459) Boost.MPLの残っていた使用部分を削除
    - [GitHub #411](https://github.com/boostorg/gil/pull/411) すべてのマクロを`BOOST_GIL_`プレフィックスをつけるよう名称変更
    - [GitHub #419](https://github.com/boostorg/gil/pull/419) CMakeのすべての設定オプションを`BOOST_GIL_`プレフィックスをつけるよう名称変更
    - [GitHub #466](https://github.com/boostorg/gil/pull/466) 使用されておらず、およらく未完成の`extension/dynamic_image/reduce.hpp`を削除。これは、Lubomir Bourdev, Jaakko Jarviによる論文[「Efficient Run-Time Dispatching in Generic Programming with Minimal Code Bloat (最小のコード量によるジェネリックプログラミングでの効率的な実行時ディスパッチ)」](http://lubomir.org/academic/MinimizingCodeBloat.pdf)で解説される手法を実装する試みだった
    - Boost.MPL、Boost.System、Boost.Testへの直接的な依存を削除
    - I/O拡張テストのpublicなコンパイル時設定マクロを削除し始めた。例として`BOOST_GIL_IO_TEST_ALLOW_READING_IMAGES`と`BOOST_GIL_IO_TEST_ALLOW_WRITING_IMAGES`を削除し、代わりにテストターゲットがビルドされると、すべてのテストケースが無条件にビルドされる
- 修正
    - [GitHub #433](https://github.com/boostorg/gil/pull/433) I/O拡張オブジェクトの破棄中に`longjump`の相互作用を回避
    - [GitHub #429](https://github.com/boostorg/gil/pull/429) `image`クラスのコンストラクタでの`alignment`パラメータにデフォルト値が抜けていた
    - [GitHub #414](https://github.com/boostorg/gil/pull/414) 破損した (corrupted) PNGファイルを読み込んだときにセグメンテーション違反が起きる問題を修正
    - [GitHub #409](https://github.com/boostorg/gil/pull/409) I/O拡張の古いI/O v1インタフェースの、戻り値の不正な初期化を修正
- 謝辞
    - Samuel Debionne, Thiago Henrique Hüpner, Pranam Lashkari, Mateusz Loskot, Debabrata Mandal, Olzhas Zhumabek氏らに感謝


## <a id="lexical-cast" href="#lexical-cast">LexicalCast</a>

- [GitHub #31](https://github.com/boostorg/lexical_cast/pull/31), [GitHub #32](https://github.com/boostorg/lexical_cast/pull/32) CI強化と壊れた標準ライブラリへのワークアラウンドを含むメンテナンス作業 (Nikita Kniazev氏に感謝)


## <a id="log" href="#log">Log</a>

- 新機能
    - [GitHub #103](https://github.com/boostorg/log/issues/103) trivial loggingで使用されるデフォルトのsinkは、ロギングコアにsinkが登録されていない場合に、各ログ記録のあとに自動的に出力をフラッシュするようになった
    - `core::flush`は、sinkが登録されていない場合に、trivial loggingで使用されるデフォルトsinkに対してフラッシュを実行するようになった
- バグ修正
    - [GitHub #97](https://github.com/boostorg/log/issues/97) いくつかのsyslog APIの実装 (例としてglibc) のためにワークアラウンドを追加。これにより、`openlog`の呼び出しでアプリケーション識別文字列が保存されないようになる。それらの実装では`syslog`呼び出しにおいてすでに解放されたメモリにアクセスする可能性があり、未定義動作を引き起こす
    - [GitHub #98](https://github.com/boostorg/log/issues/98) 月日を指定したログローテーション (例として`rotation_at_time_point(boost::gregorian::greg_day(1))`) で、静かに無視されてなにも起こらなかった問題を修正
    - ログレコードがまだ書き込まれておらず、ターゲットファイルのパターンが設定されている場合に、`text_file_backend::rotate_file`が例外を送出する可能性があった問題を修正
    - ライブラリの様々なコンポーネントを`std::allocator_traits`に移植し、C++20アロケータとの互換性を改善
    - [GitHub #102](https://github.com/boostorg/log/issues/102) MSYS2 Cygwin環境でのビルド時のコンパイルエラーを修正


## <a id="mp11" href="#mp11">Mp11</a>

- `mp_unique_if`を追加 (Kris Jusiak氏による貢献)
- `mp_flatten`を追加
- `mp_rotate_left`, `mp_rotate_right`を追加 (Duncan Barber氏による貢献)
- `mp_compose`を追加
- `mp_power_set`を追加
- `mp_partial_sum`を追加
- `mp_iterate`を追加


## <a id="multi-index" href="#multi-index">Multi-index</a>

- `multi_index_container`を[アロケータの状態を伝播する](ttps://en.cppreference.com/w/cpp/named_req/AllocatorAwareContainer)ようにした
- [GitHub #29](https://github.com/boostorg/multi_index/issues/29) `[[swappable.requirements]]`の標準仕様に従って、`KeyFromValue`、`Compare`、`Hash`、`Pred`の内部オブジェクトをswapする際に、`std::swap`とADLによって見つかる`swap`で適切に選択するようにした
- 一部のコンパイラで警告が起きていた、C++11で非推奨となったデフォルトで暗黙定義される内部的なコピーコンストラクタと代入演算子のいくつかを、提供するようにした
- メンテナンス上の修正


## <a id="outcome" href="#outcome">Outcome</a>

- 強化
    - ClangでコンパイルされたOutcomeベースのコードのパフォーマンスを大幅に改善した。以前の実装では状態ビットフィールドでClangのオプティマイザが混乱し、低品質のコード生成が行われてしまっていた。多くのコード生成の問題とは異なり、[P1886 Error speed benchmarking](https://wg21.link/P1886)で示された、現実的なコードでの経験的なベンチマークで判明した
    - Outcome v2.2.0の将来的な機能として予定していた[`better_optimisation`ブランチ (より良い最適化)](https://github.com/ned14/outcome/tree/better_optimisation)のうち安全な部分を、Outcome v2.1.3にマージした。これには新たな状態ビットフィールドの実装も含まれる。これはClangのオプティマイザを混乱させないためのものであり、Clang 9はさまざまなユースケースでGCC 9を上回るコードを生成するようになった
    - インストールできることをコミットの度にCIでテストするようにした。スタンドアロン版のOutcomeのインストール (たとえば`make install`) は理想よりも頻繁に壊れるので、コミットごとにCIでテストするようにした
- バグ修正
    - [GitHub #214](https://github.com/ned14/outcome/issues/214) 新たなコンセプトを実装するコンパイラは`T`と`E`の破棄性を早期にチェックしてしまうことが不満だったため、テンプレート制約を削除し、型のインスタンス化シーケンスの後半で実行されるstatic assertにフォールバックするようにした
    - [GitHub #220](https://github.com/ned14/outcome/issues/220) Undefined Behaviour Sanitiserがいくつかの実験的なOutcome機能のユースケースで誤検知してしまうため、ワークアラウンドを入れた


## <a id="poly-collection" href="#poly-collection">PolyCollection</a>

- `boost::poly_collection::for_each`内での潜在的なムーブの警告を修正
- 状態を伝播しない非等値なアロケータにおける、アロケータ拡張のムーブ構築とムーブ代入で、要素がムーブではなくコピーされてしまう問題を修正
- GCC 4.8の同梱される古いバージョンのlibstdc++-v3において、アロケータ拡張のムーブ構築が、アロケータ拡張のコピー構築にdecayされないようにした (Clangでも使用できる)


## <a id="stacktrace" href="#stacktrace">Stacktrace</a>

- [GitHub #55](https://github.com/boostorg/stacktrace/issues/55), [GitHub #47](https://github.com/boostorg/stacktrace/issues/47) PDBの配布についてドキュメントに記載 (情報提供してくれたemptyVoid氏とRoger Orr氏、テストに協力してくれたzlojvavan氏に感謝)
- msvc-9のビルドを修正
- テスト修正 ([GitHub #86](https://github.com/boostorg/stacktrace/issues/86))、typo修正 ([GitHub #84](https://github.com/boostorg/stacktrace/pull/84))、CI改善と強化、インスペクトツールの修正を含むメンテナンス作業


## <a id="throw-exception" href="#throw-exception">ThrowException</a>

- `throw_exception`関数に`boost::source_location`オブジェクトをとるオーバーロードを追加
    - 注 : 例外を無効にして`BOOST_THROW_EXCEPTION`を使用するプロジェクトでは、このオーバーロードが必要になる


## <a id="type-index" href="#type-index">TypeIndex</a>

- インスペクトツールによるCIインテグレーションを含むメンテナンス作業


## <a id="variant" href="#variant">Variant</a>

- [GitHub #74](https://github.com/boostorg/variant/pull/74) 未使用のインクルードを削除 (Nikita Kniazev氏に感謝)
- typo修正を含むメンテナンス作業


## <a id="variant2" href="#variant2">Variant2</a>

- `std::hash`, `boost::hash`のサポートを追加
- `T...`のすべての型がtrivialの場合に`variant<T...>`はtrivialとなる
    - これにより、レジスタ内の関数に渡したり、そこから返したりするパフォーマンスが改善する


## <a id="b2" href="#b2">B2</a>

- B2のリリース[4.2.0](https://github.com/boostorg/build/releases/tag/4.2.0)を含める
- <span style="color:red;">**警告**</span> : B2の4.0.0以降は、bootstrapを実行するためにC++11コンパイラが必要となる。これはB2自身をビルドするために必要なことであり、Boostをビルドするために使用するわけではない



## テスト済みコンパイラ
主要なテストコンパイラ:

- Linux:
    - Clang:
    - GCC:
    - Intel:
    - QCC:
- OS X:
    - Apple Clang:
    - GCC:
    - Intel:
- Windows:
    - GCC, mingw:
    - Visual C++:
- FreeBSD:
    - GCC:
- QNX:
    - QCC:

追加で含まれるテストコンパイラ:

- Linux:
    - Clang:
    - GCC:
    - GCC, C++11:
    - GCC, C++14:
    - Intel:
    - Intel, C++11:
- OS X:
    - Apple Clang:
    - Apple Clang, C++11:
    - Apple Clang, C++14:
    - Clang:
    - Clang, C++11:
    - GCC:
    - Intel:
- Windows:
    - GCC, mingw:
    - Visual C++:
- FreeBSD:
    - GCC:
- QNX:
    - QCC:

## 翻訳
[Akira Takahashi](https://github.com/faithandbrave)

